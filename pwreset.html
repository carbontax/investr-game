<!DOCTYPE html>
<html>
<head>
    <title>INVESTR-GAME</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="resources/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="resources/bootstrap/css/bootstrap-responsive.min.css"/>
	<link rel="stylesheet" type="text/less" href="resources/css/investr.less"/>

    <script type="text/javascript" src="resources/js/less-1.3.0.min.js"></script>
    <script type="text/javascript" src="resources/js/jquery.1.7.2.min.js"></script>
 	<script type="text/javascript" src="resources/js/jquery.validate.min.js"></script>
 	<script type="text/javascript">
	$(document).ready(function() {
		$('#login-spinner').hide();
		$('#new-password-container').hide();
		function getParam(name){
			   if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
			      return decodeURIComponent(name[1]);
		}
		
		var token = getParam('token');
		
		if(token === undefined) {
			$('#error-message').html("You must provide a valid token to use this form.");
		} else {
			$("#token").val(token);
			$.ajax({
				url: 'api/pwreset?token=' + token,
				dataType: 'json',
				success: function(data) {
					$("#email").html(data['email']);
					$('#new-password-container').show();
					console.log(data);
				},
				error: function(xhr) {
					var message = xhr.responseText.replace(/"/g, "");
					$('#error-message').html(message);
				}
			});
		}
		
		$('#new-password-form').validate({
			rules: {
				'confirm-password': { 
					equalTo: "#password"
				}
			}
		});

	});
	</script>
</head>
<body>
	<div class="container-fluid" id="investr-container">
		<div id="header-container">
			<div class="row" id="header">
				<div class="span8">
					<div id="logo-container">
						<span id="site-title">Investr</span>
					</div>
				</div>
				<div class="span4" id="top-menu-container">
			    </div>
			 </div>
		</div>
		<div class="row-fluid" >
			<span id="error-container" >
				<h3 id="error-message" class="errors"></h3>
			</span>
		</div>
		
		<div class="row-fluid" >
			<span id="new-password-container" >
				<h3 id="new-password-message">
				    Change password for <span id="email">Email</span>
				</h3>
				<div>
		      	<form id="new-password-form" method="post" action="api/pwreset">
		      		<input type="hidden" name="token" id="token" />
		            <div>
		                <label for="password">Password:</label>
		                <input type="password" id="password" name="password" minlength="6" required/>
		            </div>
		            <div>
		                <label for="confirm-password">Retype Password:</label><input type="password" id="confirm-password" name="confirm-password"/>
		            </div>
		            <div><input id="new-password-submit-button" type="submit" name="submit" class="btn" value="Save Password" />
		            <img id="login-spinner" src="resources/images/spinner-large.gif" data-bind="visible: showSpinner"/></div>
                </form>
                </div>
			</span>
		</div>
	</div>
</body>
</html>